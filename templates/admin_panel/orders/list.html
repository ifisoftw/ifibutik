{% extends 'admin_panel/base.html' %}

{% block title %}Siparişler{% endblock %}
{% block page_title %}
<div class="flex items-center gap-3">
    <div class="w-10 h-10 bg-gradient-to-br from-indigo-400 to-indigo-600 rounded-xl flex items-center justify-center shadow-lg">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
        </svg>
    </div>
    <div>
        <h1 class="text-2xl font-black text-gray-900">Sipariş Yönetimi</h1>
        <p class="text-sm text-gray-500 font-medium">Siparişleri yönetin ve takip edin</p>
    </div>
</div>
{% endblock %}

{% block content %}

<section class="space-y-6" x-data="{ 
             selectedItems: [],
             selectAll: false,
             allIds: [{% for o in page_obj %}'{{ o.id }}'{% if not forloop.last %},{% endif %}{% endfor %}],
             toggleAll() {
                 if (this.selectAll) {
                     this.selectedItems = [...this.allIds];
                 } else {
                     this.selectedItems = [];
                 }
             },
             toggleItem(id) {
                 const index = this.selectedItems.indexOf(id);
                 if (index > -1) {
                     this.selectedItems.splice(index, 1);
                 } else {
                     this.selectedItems.push(id);
                 }
             }
         }">

    <!-- Statistics Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        <!-- Toplam Sipariş -->
        <div class="bg-white border border-gray-200 rounded-xl p-4 shadow-sm">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-xs font-medium text-gray-500 uppercase">Toplam Sipariş</p>
                    <p class="text-2xl font-bold text-gray-900 mt-1">{{ stats.total }}</p>
                </div>
                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
                    </svg>
                </div>
            </div>
        </div>
        
        <!-- Bekleyen Siparişler -->
        <div class="bg-white border border-gray-200 rounded-xl p-4 shadow-sm">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-xs font-medium text-gray-500 uppercase">Bekleyen</p>
                    <p class="text-2xl font-bold text-gray-900 mt-1">{{ stats.pending }}</p>
                    <p class="text-xs text-amber-600 mt-1">Yeni siparişler</p>
                </div>
                <div class="w-12 h-12 bg-amber-100 rounded-lg flex items-center justify-center">
                    <svg class="w-6 h-6 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
            </div>
        </div>
        
        <!-- Kargodaki Siparişler -->
        <div class="bg-white border border-gray-200 rounded-xl p-4 shadow-sm">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-xs font-medium text-gray-500 uppercase">Kargoda</p>
                    <p class="text-2xl font-bold text-gray-900 mt-1">{{ stats.shipped }}</p>
                    <p class="text-xs text-blue-600 mt-1">Yolda</p>
                </div>
                <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                    <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path d="M9 17a2 2 0 11-4 0 2 2 0 014 0zM19 17a2 2 0 11-4 0 2 2 0 014 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16V6a1 1 0 00-1-1H4a1 1 0 00-1 1v10a1 1 0 001 1h1m8-1a1 1 0 01-1 1H9m4-1V8a1 1 0 011-1h2.586a1 1 0 01.707.293l3.414 3.414a1 1 0 01.293.707V16a1 1 0 01-1 1h-1m-6-1a1 1 0 001 1h1M5 17a2 2 0 104 0m-4 0a2 2 0 114 0m6 0a2 2 0 104 0m-4 0a2 2 0 114 0"></path>
                    </svg>
                </div>
            </div>
        </div>
        
        <!-- Bugünün Geliri -->
        <div class="bg-white border border-gray-200 rounded-xl p-4 shadow-sm">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-xs font-medium text-gray-500 uppercase">Bugünün Geliri</p>
                    <p class="text-2xl font-bold text-gray-900 mt-1">₺{{ stats.today_revenue|floatformat:0 }}</p>
                    <p class="text-xs text-emerald-600 mt-1">{{ stats.today }} sipariş</p>
                </div>
                <div class="w-12 h-12 bg-emerald-100 rounded-lg flex items-center justify-center">
                    <svg class="w-6 h-6 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
            </div>
        </div>
    </div>

    <!-- Additional Stats Row -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <!-- İşleme Alınan -->
        <div class="bg-white border border-gray-200 rounded-xl p-4 shadow-sm">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-xs font-medium text-gray-500 uppercase">İşleme Alınan</p>
                    <p class="text-xl font-bold text-gray-900 mt-1">{{ stats.processing }}</p>
                </div>
                <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                    <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                    </svg>
                </div>
            </div>
        </div>
        
        <!-- İptal Edilen -->
        <div class="bg-white border border-gray-200 rounded-xl p-4 shadow-sm">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-xs font-medium text-gray-500 uppercase">İptal Edilen</p>
                    <p class="text-xl font-bold text-gray-900 mt-1">{{ stats.cancelled }}</p>
                </div>
                <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center">
                    <svg class="w-5 h-5 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"></path>
                    </svg>
                </div>
            </div>
        </div>
        
        <!-- Aylık Gelir -->
        <div class="bg-white border border-gray-200 rounded-xl p-4 shadow-sm">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-xs font-medium text-gray-500 uppercase">Aylık Gelir</p>
                    <p class="text-xl font-bold text-gray-900 mt-1">₺{{ stats.month_revenue|floatformat:0 }}</p>
                </div>
                <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                    <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </svg>
                </div>
            </div>
        </div>
    </div>

    <!-- Bulk Actions Bar -->
    <div x-show="selectedItems.length > 0" x-transition x-cloak
        class="fixed bottom-6 left-1/2 transform -translate-x-1/2 z-50">
        <div class="glass-card rounded-2xl shadow-2xl px-6 py-4 flex items-center gap-4">
            <span class="text-sm font-semibold text-gray-900">
                <span x-text="selectedItems.length"></span> sipariş seçildi
            </span>
            
            <!-- Durum Güncelle -->
            <form hx-post="{% url 'admin_order_bulk_action' %}" hx-swap="none" class="contents">
                {% csrf_token %}
                <input type="hidden" name="action" value="processing">
                <template x-for="id in selectedItems" :key="id">
                    <input type="hidden" name="selected_items" :value="id">
                </template>
                {% include 'admin_panel/components/button.html' with label='İşleme Al' variant='primary' size='sm' type='submit' %}
            </form>
            
            <form hx-post="{% url 'admin_order_bulk_action' %}" hx-swap="none" class="contents">
                {% csrf_token %}
                <input type="hidden" name="action" value="shipped">
                <template x-for="id in selectedItems" :key="id">
                    <input type="hidden" name="selected_items" :value="id">
                </template>
                {% include 'admin_panel/components/button.html' with label='Kargola' variant='success' size='sm' type='submit' %}
            </form>
            
            <form hx-post="{% url 'admin_order_bulk_action' %}" hx-swap="none" class="contents">
                {% csrf_token %}
                <input type="hidden" name="action" value="cancelled">
                <template x-for="id in selectedItems" :key="id">
                    <input type="hidden" name="selected_items" :value="id">
                </template>
                {% include 'admin_panel/components/button.html' with label='İptal Et' variant='danger' size='sm' type='submit' %}
            </form>
            
            <!-- Export -->
            <form action="{% url 'admin_order_bulk_action' %}" method="POST" class="contents">
                {% csrf_token %}
                <input type="hidden" name="action" value="export">
                <template x-for="id in selectedItems" :key="id">
                    <input type="hidden" name="selected_items" :value="id">
                </template>
                <button type="submit" class="px-3 py-1.5 text-sm bg-gray-100 text-gray-700 hover:bg-gray-200 rounded-lg font-medium transition-colors">
                    Excel İndir
                </button>
            </form>
            
            <!-- Print -->
            <form action="{% url 'admin_order_print' %}" method="POST" target="_blank" class="contents">
                {% csrf_token %}
                <template x-for="id in selectedItems" :key="id">
                    <input type="hidden" name="selected_items" :value="id">
                </template>
                <button type="submit" class="px-3 py-1.5 text-sm bg-gray-100 text-gray-700 hover:bg-gray-200 rounded-lg font-medium transition-colors">
                    Yazdır
                </button>
            </form>
            
            <button @click="selectedItems = []; selectAll = false"
                class="px-3 py-1.5 text-sm text-gray-600 hover:text-gray-900 font-medium transition-colors">
                İptal
            </button>
        </div>
    </div>

    <!-- Filters -->
    <div class="bg-white border border-gray-200 rounded-xl shadow-sm p-3">
        <form method="GET" class="space-y-3">
            <!-- Search Bar -->
            <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <svg class="h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                </div>
                <input type="text" name="search" value="{{ search }}" 
                    placeholder="Sipariş no, müşteri adı, telefon veya takip kodu..."
                    class="block w-full pl-9 pr-3 py-2 bg-gray-50 border-gray-200 rounded-lg text-sm text-gray-900 placeholder-gray-400 focus:bg-white focus:ring-1 focus:ring-primary focus:border-primary transition-all">
                {% if search %}
                <div class="absolute inset-y-0 right-0 pr-2 flex items-center">
                    <a href="{% url 'admin_orders' %}" class="text-gray-400 hover:text-gray-600">
                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </a>
                </div>
                {% endif %}
            </div>

            <!-- Compact Filters Grid -->
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-2">
                <!-- Status -->
                <div class="col-span-1 lg:col-span-1">
                    <select name="status" onchange="this.form.submit()"
                        class="w-full rounded-lg border-gray-200 text-sm py-2 px-2 focus:ring-1 focus:ring-primary focus:border-primary">
                        <option value="">Durum: Tümü</option>
                        {% for code, label, count in status_choices %}
                        <option value="{{ code }}" {% if status == code %}selected{% endif %}>{{ label }} ({{ count }})</option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Campaign -->
                <div class="col-span-1 lg:col-span-1">
                    <select name="campaign" onchange="this.form.submit()"
                        class="w-full rounded-lg border-gray-200 text-sm py-2 px-2 focus:ring-1 focus:ring-primary focus:border-primary">
                        <option value="">Kampanya: Tümü</option>
                        {% for campaign in campaigns %}
                        <option value="{{ campaign.id }}" {% if campaign_id|default:'' == campaign.id|stringformat:'s' %}selected{% endif %}>
                            {{ campaign.title|truncatechars:15 }} ({{ campaign.count }})
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Product -->
                <div class="col-span-1 lg:col-span-1">
                    <select name="product" onchange="this.form.submit()"
                        class="w-full rounded-lg border-gray-200 text-sm py-2 px-2 focus:ring-1 focus:ring-primary focus:border-primary">
                        <option value="">Ürün: Tümü</option>
                        {% for product in products %}
                        <option value="{{ product.id }}" {% if product_id|default:'' == product.id|stringformat:'s' %}selected{% endif %}>
                            {{ product.name|truncatechars:15 }} ({{ product.count }})
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Size -->
                <div class="col-span-1 lg:col-span-1">
                    <select name="size" onchange="this.form.submit()"
                        class="w-full rounded-lg border-gray-200 text-sm py-2 px-2 focus:ring-1 focus:ring-primary focus:border-primary">
                        <option value="">Beden: Tümü</option>
                        {% for size_obj in available_sizes %}
                        <option value="{{ size_obj.name }}" {% if size_filter == size_obj.name %}selected{% endif %}>{{ size_obj.name }} ({{ size_obj.count }})</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="col-span-2 lg:col-span-2 relative" x-data="{
                    isOpen: false,
                    start: '{{ date_from|default:'' }}',
                    end: '{{ date_to|default:'' }}',
                    label: 'Tarih Aralığı',
                    presets: [
                        { label: 'Bugün', days: 0 },
                        { label: 'Dün', days: 1 },
                        { label: 'Son 7 Gün', days: 7 },
                        { label: 'Son 30 Gün', days: 30 },
                        { label: 'Bu Ay', type: 'month' },
                        { label: 'Geçen Ay', type: 'last_month' },
                        { label: 'Tüm Zamanlar', type: 'all' }
                    ],
                    init() {
                        this.updateLabel();
                    },
                    updateLabel() {
                        if (this.start && this.end) {
                            const formatDate = (d) => {
                                const [y, m, d_] = d.split('-');
                                return `${d_}.${m}.${y}`;
                            };
                            this.label = `${formatDate(this.start)} - ${formatDate(this.end)}`;
                        } else {
                            this.label = 'Tarih Aralığı';
                        }
                    },
                    applyPreset(preset) {
                        const today = new Date();
                        let start = new Date();
                        let end = new Date();

                        if (preset.type === 'all') {
                            this.start = '';
                            this.end = '';
                        } else if (preset.type === 'month') {
                            start = new Date(today.getFullYear(), today.getMonth(), 1);
                            end = today;
                        } else if (preset.type === 'last_month') {
                            start = new Date(today.getFullYear(), today.getMonth() - 1, 1);
                            end = new Date(today.getFullYear(), today.getMonth(), 0);
                        } else if (preset.label === 'Dün') {
                            start.setDate(today.getDate() - 1);
                            end.setDate(today.getDate() - 1);
                        } else {
                            start.setDate(today.getDate() - preset.days + (preset.days === 0 ? 0 : 1));
                            if (preset.days > 1) start.setDate(today.getDate() - preset.days + 1);
                        }

                        if (preset.type !== 'all') {
                            this.start = start.toISOString().split('T')[0];
                            this.end = end.toISOString().split('T')[0];
                        }

                        // Update hidden inputs and submit
                        this.$refs.dateFrom.value = this.start;
                        this.$refs.dateTo.value = this.end;
                        this.$el.closest('form').submit();
                    },
                    applyCustom() {
                        this.$refs.dateFrom.value = this.start;
                        this.$refs.dateTo.value = this.end;
                        this.$el.closest('form').submit();
                    }
                }" @click.away="isOpen = false">
                    
                    <!-- Hidden Inputs -->
                    <input type="hidden" name="date_from" x-ref="dateFrom" value="{{ date_from|default:'' }}">
                    <input type="hidden" name="date_to" x-ref="dateTo" value="{{ date_to|default:'' }}">

                    <!-- Trigger Button -->
                    <button type="button" @click="isOpen = !isOpen"
                        class="w-full flex items-center justify-between rounded-lg border border-gray-200 bg-white text-sm py-2 px-3 hover:bg-gray-50 focus:ring-1 focus:ring-primary focus:border-primary transition-colors">
                        <span class="flex items-center gap-2 text-gray-700 truncate">
                            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                            <span x-text="label"></span>
                        </span>
                        <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </button>

                    <!-- Dropdown Panel -->
                    <div x-show="isOpen" x-transition.origin.top.left
                        class="absolute z-50 top-full left-0 mt-1 w-72 bg-white rounded-xl shadow-xl border border-gray-100 overflow-hidden">
                        <div class="flex flex-col">
                            <!-- Presets -->
                            <div class="p-2 border-b border-gray-100 bg-gray-50/50 grid grid-cols-2 gap-1">
                                <template x-for="preset in presets">
                                    <button type="button" @click="applyPreset(preset)"
                                        class="text-left px-3 py-1.5 text-xs font-medium text-gray-600 hover:bg-white hover:text-primary hover:shadow-sm rounded-lg transition-all">
                                        <span x-text="preset.label"></span>
                                    </button>
                                </template>
                            </div>

                            <!-- Custom Range -->
                            <div class="p-3 space-y-3">
                                <div class="grid grid-cols-2 gap-2">
                                    <div>
                                        <label class="block text-[10px] font-semibold text-gray-400 uppercase mb-1">Başlangıç</label>
                                        <input type="date" x-model="start"
                                            class="w-full rounded-lg border-gray-200 text-xs py-1.5 px-2 focus:ring-1 focus:ring-primary focus:border-primary">
                                    </div>
                                    <div>
                                        <label class="block text-[10px] font-semibold text-gray-400 uppercase mb-1">Bitiş</label>
                                        <input type="date" x-model="end"
                                            class="w-full rounded-lg border-gray-200 text-xs py-1.5 px-2 focus:ring-1 focus:ring-primary focus:border-primary">
                                    </div>
                                </div>
                                <button type="button" @click="applyCustom()"
                                    class="w-full py-2 text-xs font-semibold text-white bg-primary hover:bg-primary-dark rounded-lg transition-colors shadow-sm shadow-primary/30">
                                    Uygula
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Per Page -->
                <div class="col-span-1 lg:col-span-1">
                    <select name="per_page" onchange="this.form.submit()"
                        class="w-full rounded-lg border-gray-200 text-sm py-2 px-2 focus:ring-1 focus:ring-primary focus:border-primary">
                        {% for size in per_page_options %}
                        <option value="{{ size }}" {% if per_page == size %}selected{% endif %}>{{ size }} / Sayfa</option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Clear Button -->
                <div class="col-span-1 lg:col-span-1">
                    {% url 'admin_orders' as orders_url %}
                    <a href="{{ orders_url }}" 
                       class="flex items-center justify-center w-full h-full px-2 py-2 text-sm font-medium text-gray-500 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors" title="Filtreleri Temizle">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </a>
                </div>
            </div>
        </form>
    </div>

    <!-- Top Actions -->
    <div class="flex items-center justify-between">
        <p class="text-sm text-gray-600">
            <span class="font-semibold text-gray-900">{{ page_obj.paginator.count }}</span> sipariş bulundu
        </p>
        <div class="flex items-center gap-3">
            <form method="POST" action="{% url 'admin_order_bulk_action' %}" style="display: inline;">
                {% csrf_token %}
                <input type="hidden" name="action" value="export">
                {% for order in page_obj %}
                <input type="hidden" name="selected_items" value="{{ order.id }}">
                {% endfor %}
                <button type="submit"
                    class="flex items-center gap-2 px-4 py-2.5 bg-white border border-gray-300 text-gray-700 font-semibold rounded-xl hover:bg-gray-50 shadow transition-all">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    Tümünü İndir
                </button>
            </form>
        </div>
    </div>

    <!-- Orders Table -->
    <div class="bg-white border border-gray-200 rounded-2xl shadow-sm overflow-hidden">
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-100">
                <thead class="bg-gray-50 text-[11px] font-semibold uppercase tracking-wide text-gray-500">
                    <tr>
                        <th class="px-4 py-3 w-12">
                            <input type="checkbox" x-model="selectAll" @change="toggleAll()"
                                class="w-4 h-4 rounded border-gray-300 text-primary focus:ring-primary">
                        </th>
                        {% include 'admin_panel/orders/partials/sort_header.html' with label='Sipariş No' column='id' align='left' %}
                        {% include 'admin_panel/orders/partials/sort_header.html' with label='Müşteri' column='customer' align='left' %}
                        <th class="px-4 py-3 text-left">Kampanya</th>
                        <th class="px-4 py-3 text-left">Sipariş Takip No</th>
                        {% include 'admin_panel/orders/partials/sort_header.html' with label='Tutar' column='amount' align='center' %}
                        {% include 'admin_panel/orders/partials/sort_header.html' with label='Tarih' column='created_at' align='center' %}
                        {% include 'admin_panel/orders/partials/sort_header.html' with label='Durum' column='status' align='center' %}
                        <th class="px-4 py-3 text-center">İşlemler</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-100 text-sm" id="orders-tbody">
                    {% for order in page_obj %}
                    {% include 'admin_panel/orders/partials/order_row.html' %}
                    {% empty %}
                    <tr>
                        <td colspan="8" class="px-4 py-12 text-center text-gray-500">
                            Filtre kriterlerine uyan sipariş bulunamadı.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        {% if page_obj.paginator.num_pages > 1 %}
        <div
            class="flex flex-col md:flex-row items-center justify-between gap-3 px-4 py-4 border-t border-gray-100 text-sm">
            <p class="text-gray-500">
                {{ page_obj.paginator.count }} kayıttan
                <span class="font-semibold text-gray-900">
                    {{ page_obj.start_index }} - {{ page_obj.end_index }}
                </span>
                arası gösteriliyor.
            </p>
            <div class="flex items-center gap-2">
                {% if page_obj.has_previous %}
                <a href="?page={{ page_obj.previous_page_number }}&sort={{ sort }}&dir={{ direction }}{{ query_string }}"
                    class="px-3 py-1.5 rounded-xl border border-gray-200 text-gray-600 hover:bg-gray-100">Önceki</a>
                {% else %}
                <span class="px-3 py-1.5 rounded-xl border border-gray-100 text-gray-300">Önceki</span>
                {% endif %}

                <span class="px-3 py-1.5 rounded-xl bg-gray-100 text-gray-700 font-semibold">
                    Sayfa {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}
                </span>

                {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}&sort={{ sort }}&dir={{ direction }}{{ query_string }}"
                    class="px-3 py-1.5 rounded-xl border border-gray-200 text-gray-600 hover:bg-gray-100">Sonraki</a>
                {% else %}
                <span class="px-3 py-1.5 rounded-xl border border-gray-100 text-gray-300">Sonraki</span>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>
</section>

<!-- Modal Container for HTMX -->
<div id="modal-container"></div>

{% endblock %}

{% block extra_scripts %}
<script>
    // HTMX event listeners
    document.body.addEventListener('orderListChanged', () => {
        window.location.reload();
    });
    
    document.body.addEventListener('orderStatusUpdated', () => {
        window.location.reload();
    });
    
    document.body.addEventListener('cargoUpdated', () => {
        window.location.reload();
    });
    
    // Modal success handler
    document.body.addEventListener('modalSuccess', () => {
        // Close modal
        document.getElementById('modal-container').innerHTML = '';
        // Reload page
        window.location.reload();
    });
</script>
{% endblock %}